{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Standard Response Envelope",
  "description": "Unified response format for all Sonia Stack services (Phase 2+)",
  "type": "object",
  "required": [
    "ok",
    "service",
    "operation",
    "correlation_id",
    "duration_ms",
    "data",
    "error"
  ],
  "properties": {
    "ok": {
      "type": "boolean",
      "description": "Operation success status. true if successful, false if failed."
    },
    "service": {
      "type": "string",
      "description": "Service that generated this response",
      "enum": [
        "api-gateway",
        "memory-engine",
        "model-router",
        "openclaw",
        "pipecat",
        "eva-os"
      ]
    },
    "operation": {
      "type": "string",
      "description": "Operation performed (e.g., 'chat', 'execute', 'store', 'session_start')"
    },
    "correlation_id": {
      "type": "string",
      "description": "Request correlation ID for tracing across services. Format: req_<12_hex_chars>"
    },
    "duration_ms": {
      "type": "number",
      "description": "Time taken to complete operation in milliseconds",
      "minimum": 0
    },
    "data": {
      "oneOf": [
        {
          "type": "object",
          "description": "Operation result when ok=true"
        },
        {
          "type": "null",
          "description": "null when ok=false"
        }
      ]
    },
    "error": {
      "oneOf": [
        {
          "type": "object",
          "description": "Error details when ok=false",
          "required": [
            "code",
            "message"
          ],
          "properties": {
            "code": {
              "type": "string",
              "description": "Error code",
              "enum": [
                "NOT_FOUND",
                "INVALID_ARGUMENT",
                "TIMEOUT",
                "UNAVAILABLE",
                "INTERNAL_ERROR",
                "POLICY_DENIED",
                "CHAT_FAILED",
                "EXECUTE_FAILED",
                "STORE_FAILED",
                "RECALL_FAILED",
                "SEARCH_FAILED",
                "ROUTE_FAILED",
                "SESSION_NOT_FOUND",
                "WEBSOCKET_ERROR"
              ]
            },
            "message": {
              "type": "string",
              "description": "Human-readable error message"
            },
            "details": {
              "type": "object",
              "description": "Optional additional error details"
            }
          },
          "additionalProperties": false
        },
        {
          "type": "null",
          "description": "null when ok=true"
        }
      ]
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "ok": true,
      "service": "api-gateway",
      "operation": "chat",
      "correlation_id": "req_a1b2c3d4e5f6",
      "duration_ms": 145.23,
      "data": {
        "response": "The weather is sunny",
        "model": "qwen2:7b",
        "provider": "ollama",
        "context_used": true,
        "provenance": {
          "memory_engine": {
            "status": "ok",
            "duration_ms": 12.5
          },
          "model_router": {
            "status": "ok",
            "duration_ms": 132.73
          }
        }
      },
      "error": null
    },
    {
      "ok": false,
      "service": "openclaw",
      "operation": "execute",
      "correlation_id": "req_x9y8z7w6v5u4",
      "duration_ms": 5.12,
      "data": null,
      "error": {
        "code": "POLICY_DENIED",
        "message": "Command 'Remove-Item' not in allowlist",
        "details": {
          "command": "Remove-Item",
          "reason": "destructive_operation_blocked"
        }
      }
    },
    {
      "ok": false,
      "service": "api-gateway",
      "operation": "chat",
      "correlation_id": "req_m1n2o3p4q5r6",
      "duration_ms": 10234.5,
      "data": null,
      "error": {
        "code": "TIMEOUT",
        "message": "Model Router request timed out",
        "details": {
          "timeout_seconds": 10,
          "service": "model-router"
        }
      }
    }
  ]
}
