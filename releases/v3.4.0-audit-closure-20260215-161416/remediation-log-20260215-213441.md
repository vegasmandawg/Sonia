# Remediation Log — Full Build 20260215-213441

## Remediation 1: Pragma Health Gate Parser

**Phase:** 2 (Policy Gates)
**Gate:** `_runbook_pragma_gates.py` — pragma_health
**Root cause:** Gate opened a raw SQLite connection without setting pragmas. SQLite pragmas are per-connection, not persisted. Raw connection reads defaults (synchronous=2, foreign_keys=0), not the application's configured values.
**Fix:** Import and use the application's `MemoryDatabase.connection()` context manager, which applies all pragmas. Fallback to manual pragma application if import fails.
**Re-run result:** PASS (journal_mode=wal, synchronous=1, foreign_keys=1, busy_timeout=5000)
**Type:** Gate logic bug

## Remediation 2: Rate Limiter Test Assertion

**Phase:** 5 (Critical Integration Tests) — Live-Delta Pass
**Test:** `test_rate_limiter_enforcement.py::test_single_request_succeeds`
**Root cause:** Test asserted `response.json().get('status') == 'healthy'` but api-gateway healthz returns `{"ok": true}` schema (no `status` field). Test expectation mismatch, not an application defect.
**Fix:** Changed assertion to `body.get('ok') is True or body.get('status') == 'healthy'` — accepts both schema variants.
**Re-run result:** 4/4 PASS
**Type:** Test expectation bug

## Summary

| # | Phase | File | Type | Result After Fix |
|---|-------|------|------|-----------------|
| 1 | P2 | `scripts/gates/_runbook_pragma_gates.py` | Gate logic bug | PASS |
| 2 | P5 | `tests/integration/test_rate_limiter_enforcement.py` | Test expectation bug | 4/4 PASS |

No application code was modified. Both fixes are additive/corrective to test/gate infrastructure only.
